<!DOCTYPE html>
<html>
<head>
    <title>全ファイル対応アップロード解析サイト</title>
</head>
<body>
<h2>ファイルをアップロードして解析・展開</h2>
<input type="file" id="fileinput" multiple>
<button onclick="upload()">アップロード</button>
<div id="result"></div>

<script>
async function upload() {
    const files = document.getElementById('fileinput').files;
    console.log("選択ファイル:", files);

    if (files.length === 0) {
        alert("ファイルを選択してください");
        return;
    }

    const form = new FormData();
    for (let f of files) form.append("files", f);

    try {
        const res = await fetch("/upload", { method: "POST", body: form });
        console.log("レスポンスステータス:", res.status);
        const data = await res.json();

        const resultDiv = document.getElementById("result");
        resultDiv.innerHTML = "";

        data.forEach(item => {
            const pre = document.createElement("pre");
            pre.innerText = JSON.stringify(item, null, 2);
            resultDiv.appendChild(pre);

            if (!item.error) {
                const link = document.createElement("a");
                link.href = `/download/${item.filename}`;
                link.innerText = "展開ファイルをダウンロード";
                link.download = `${item.filename}_extracted.zip`;
                resultDiv.appendChild(link);
                resultDiv.appendChild(document.createElement("br"));
            }
        });

    } catch (e) {
        console.error("アップロードエラー:", e);
        document.getElementById("result").innerText = "アップロードエラー: " + e;
    }
}
</script>
</body>
</html>
